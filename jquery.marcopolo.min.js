/**
 * Marco Polo v1.1.4
 *
 * A modern jQuery plugin for autocomplete functionality on a text input.
 *
 * https://github.com/jstayton/jquery-marcopolo
 *
 * Copyright Â© 2011 by Justin Stayton
 * Released under the MIT License
 * http://en.wikipedia.org/wiki/MIT_License
 */
(function(b){var l={};var g={cache:true,compare:false,data:{},delay:250,formatData:null,formatError:function(x,C,y,z,B,A){return"<em>Your search could not be completed at this time.</em>"},formatItem:function(z,x,A,y){return z.title||z.name},formatMinChars:function(z,x,A,y){return"<em>Your search must be at least <strong>"+z+"</strong> characters.</em>"},formatNoResults:function(z,x,A,y){return"<em>No results for <strong>"+z+"</strong>.</em>"},minChars:1,onChange:null,onError:null,onFocus:null,onMinChars:null,onNoResults:null,onRequestBefore:null,onRequestAfter:null,onResults:null,onSelect:function(z,x,A,y){A.val(z.title||z.name)},param:"q",required:false,selectable:"*",selected:null,url:null};var k={DOWN:40,ENTER:13,ESC:27,UP:38};var v=function(x){return x.children("li.mp_selectable:first")};var f=function(x){return x.children("li.mp_selectable:last")};var d=function(x){return x.children("li.mp_highlighted")};var j=function(x){return x.removeClass("mp_highlighted")};var c=function(x,y){j(d(y));return x.addClass("mp_highlighted")};var q=function(x){return c(v(x),x)};var o=function(z){var x=d(z);var y=x.prevAll("li.mp_selectable:first");if(!y.length){y=f(z)}return c(y,z)};var s=function(z){var x=d(z);var y=x.nextAll("li.mp_selectable:first");if(!y.length){y=v(z)}return c(y,z)};var e=function(x){return x.show()};var p=function(x){return x.hide()};var m=function(I,E,A,x,D){E.empty();if(A.formatData){D=A.formatData.call(I,D,I,E)}if(b.isEmptyObject(D)){var K=b('<li class="mp_no_results" />');var G=A.formatNoResults&&A.formatNoResults.call(I,x,K,I,E);G&&K.html(G);A.onNoResults&&A.onNoResults.call(I,x,K,I,E);I.trigger("marcopolonoresults",[x,K,I,E]);if(G){K.appendTo(E);e(E)}else{p(E)}}else{var B=I.data("marcoPolo").selected;var y=A.compare&&B;var L;var z;var F=false;for(var C=0,J;J=D[C];C++){var K=b('<li class="mp_item" />');var H=A.formatItem.call(I,J,K,I,E);K.data("marcoPolo",J);K.html(H).appendTo(E);if(y){if(A.compare===true){L=J;z=B}else{L=J[A.compare];z=B[A.compare]}if(L===z){c(K,E);y=false;F=true}}}E.children(A.selectable).addClass("mp_selectable");if(!F){q(E)}A.onResults&&A.onResults.call(I,D,I,E);I.trigger("marcopoloresults",[D,I,E]);e(E)}};var w=function(E,y,z,A,D,C){y.empty();var x=b('<li class="mp_error" />');var B=z.formatError&&z.formatError.call(E,x,E,y,A,D,C);B&&x.html(B);z.onError&&z.onError.call(E,x,E,y,A,D,C);E.trigger("marcopoloerror",[x,E,y,A,D,C]);if(B){x.appendTo(y);e(y)}else{p(y)}};var r=function(C,y,z,A){if(!A.length){p(y).empty();return}y.empty();var x=b('<li class="mp_min_chars" />');var B=z.formatMinChars&&z.formatMinChars.call(C,z.minChars,x,C,y);B&&x.html(B);z.onMinChars&&z.onMinChars.call(C,z.minChars,x,C,y);C.trigger("marcopolominchars",[z.minChars,x,C,y]);if(B){x.appendTo(y);e(y)}else{p(y)}};var i=function(x){if(x.data("marcoPolo").ajax){x.data("marcoPolo").ajaxAborted=true;x.data("marcoPolo").ajax.abort()}else{x.data("marcoPolo").ajaxAborted=false}clearTimeout(x.data("marcoPolo").timer);return x.data("marcoPolo").ajaxAborted};var h=function(z,A,x,y){A.data("marcoPolo").selected=null;A.data("marcoPolo").value=z;y.onChange&&y.onChange.call(A,z,A,x);A.trigger("marcopolochange",[z,A,x])};var a=function(z,A,x,y){i(A);if(z!==A.data("marcoPolo").value){h(z,A,x,y)}A.data("marcoPolo").timer=setTimeout(function(){if(z.length<y.minChars){r(A,x,y,z);return}var D={};D[y.param]=z;var C=b.extend({},y.data,D);var B=y.url+(y.url.indexOf("?")===-1?"?":"&")+b.param(C);if(y.cache&&l[B]){m(A,x,y,z,l[B])}else{y.onRequestBefore&&y.onRequestBefore.call(A,A,x);A.trigger("marcopolorequestbefore",[A,x]);$inputParent=A.parent().addClass("mp_busy");A.data("marcoPolo").ajax=b.ajax({url:y.url,dataType:"json",data:C,success:function(E){m(A,x,y,z,E);l[B]=E},error:function(E,G,F){if(!A.data("marcoPolo").ajaxAborted){w(A,x,y,E,G,F)}},complete:function(E,F){A.data("marcoPolo").ajax=null;A.data("marcoPolo").ajaxAborted=false;$inputParent.removeClass("mp_busy");y.onRequestAfter&&y.onRequestAfter.call(A,A,x,E,F);A.trigger("marcopolorequestafter",[A,x,E,F])}})}},y.delay)};var n=function(A,x,B,y,z){p(y);B.data("marcoPolo").selected=A;z.onSelect&&z.onSelect.call(B,A,x,B,y);B.trigger("marcopoloselect",[A,x,B,y]);B.data("marcoPolo").value=B.val()};var u=function(z,x,y){i(z);if(y.required&&!z.data("marcoPolo").selected){z.val("")}p(x)};var t={init:function(x){return this.each(function(){var B=b(this);if(B.data("marcoPolo")){return}var A=B.attr("autocomplete");B.attr("autocomplete","off");var y=b('<ol class="mp_list" />').hide().insertAfter(B);var z=b.extend({},g,x);if(!z.url){z.url=B.closest("form").attr("action")}B.data("marcoPolo",{ajax:null,ajaxAborted:false,autocomplete:A,documentMouseup:null,focus:false,$list:y,mousedown:false,selected:null,settings:z,timer:null,value:B.val()});B.bind("focus.marcoPolo",function(){B.data("marcoPolo").focus=true;z.onFocus&&z.onFocus.call(B,B,y);B.trigger("marcopolofocus",[B,y]);a(B.val(),B,y,z)}).bind("keydown.marcoPolo",function(D){switch(D.which){case k.UP:D.preventDefault();o(y);e(y);break;case k.DOWN:D.preventDefault();s(y);e(y);break;case k.ENTER:D.preventDefault();var C=d(y);if(C.length){B.blur();n(C.data("marcoPolo"),C,B,y,z)}break;case k.ESC:u(B,y,z);break}}).bind("keyup.marcoPolo",function(C){if(B.val()!==B.data("marcoPolo").value){a(B.val(),B,y,z)}}).bind("blur.marcoPolo",function(){B.data("marcoPolo").focus=false;setTimeout(function(){if(!B.data("marcoPolo").mousedown){u(B,y,z);y.empty()}},1)});y.mousedown(function(){B.data("marcoPolo").mousedown=true}).delegate("li.mp_selectable","mouseover",function(){c(b(this),y)}).delegate("li.mp_selectable","mouseout",function(){j(b(this))}).delegate("li.mp_selectable","mouseup",function(){var C=b(this);n(C.data("marcoPolo"),C,B,y,z)});B.data("marcoPolo").documentMouseup=function(){B.data("marcoPolo").mousedown=false;if(!B.data("marcoPolo").focus&&y.is(":visible")){u(B,y,z);y.empty()}};b(document).bind("mouseup.marcoPolo",B.data("marcoPolo").documentMouseup);if(z.selected){n(z.selected,null,B,y,z)}})},change:function(x){return this.each(function(){var z=b(this);var y=z.data("marcoPolo");if(!y){return}if(x!==y.value){z.val(x);h(x,z,y.$list,y.settings)}})},destroy:function(){return this.each(function(){var y=b(this);var x=y.data("marcoPolo");if(!x){return}x.$list.remove();if(x.autocomplete!=="off"){y.removeAttr("autocomplete")}b(document).unbind("mouseup.marcoPolo",y.data("marcoPolo").documentMouseup);y.unbind(".marcoPolo").removeData("marcoPolo")})},option:function(A,y){if(typeof A==="undefined"){var z=b(this);var x=z.data("marcoPolo");if(!x){return}return x.settings}else{if(typeof y==="undefined"){if(b.isPlainObject(A)){return this.each(function(){var C=b(this);var B=C.data("marcoPolo");if(!B){return}B.settings=b.extend(B.settings,A)})}else{var z=b(this);var x=z.data("marcoPolo");if(!x){return}return x.settings[A]}}else{return this.each(function(){var C=b(this);var B=C.data("marcoPolo");if(!B){return}B.settings[A]=y})}}},search:function(x){return this.each(function(){var z=b(this);var y=z.data("marcoPolo");if(!y){return}if(typeof x!=="undefined"){z.val(x)}z.focus()})}};b.fn.marcoPolo=function(x){if(t[x]){return t[x].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof x==="object"||!x){return t.init.apply(this,arguments)}else{b.error("Method "+x+" does not exist on jQuery.marcoPolo")}}}})(jQuery);